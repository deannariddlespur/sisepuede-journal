<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Me Defino - I Define Myself{% endblock %}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'entries/css/style.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Animated Stars Background - Appears on all pages -->
    <div class="day-night-gradient"></div>
    <div class="stars"></div>
    <div class="stars2"></div>
    <div class="stars3"></div>
    
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">Me Defino</h1>
            <div class="nav-links">
                <a href="{% url 'home' %}" class="nav-link">Home</a>
                <a href="{% url 'path_events_calendar' %}" class="nav-link">Define Your Path</a>
                <a href="{% url 'diary_list' %}" class="nav-link">DeAnna's Diary</a>
                {% if user.is_authenticated %}
                    {% if user.is_staff %}
                    <a href="{% url 'entry_create' %}" class="nav-link btn-primary">New Entry</a>
                    <a href="{% url 'path_event_create' %}" class="nav-link">New Event</a>
                    <a href="{% url 'diary_page_create' %}" class="nav-link">New Diary Page</a>
                    <a href="/admin/" class="nav-link">Admin</a>
                    {% endif %}
                    <span class="user-info">Welcome, {{ user.username }}</span>
                    <a href="/admin/logout/" class="nav-link">Logout</a>
                {% else %}
                    <a href="{% url 'login' %}" class="nav-link">Login</a>
                {% endif %}
            </div>
        </div>
    </nav>
    
    <main class="container">
        {% block content %}
        {% endblock %}
    </main>
    
    <footer>
        <p>&copy; 2026 Me Defino - I Define Myself</p>
    </footer>

    <script>
        // Dropdown toggle function
        function toggleDropdown(button) {
            const dropdown = button.nextElementSibling;
            const isOpen = dropdown.classList.contains('show');
            
            // Close all other dropdowns
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                menu.classList.remove('show');
            });
            
            // Toggle current dropdown
            if (!isOpen) {
                dropdown.classList.add('show');
            }
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.event-actions-dropdown')) {
                document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                    menu.classList.remove('show');
                });
            }
        });

        // Tooltip positioning for event dots
        document.addEventListener('DOMContentLoaded', function() {
            const eventDots = document.querySelectorAll('.day-event-dot');
            
            eventDots.forEach(dot => {
                dot.addEventListener('mouseenter', function() {
                    const tooltip = this.querySelector('.event-tooltip');
                    if (tooltip) {
                        const rect = this.getBoundingClientRect();
                        const tooltipRect = tooltip.getBoundingClientRect();
                        const viewportWidth = window.innerWidth;
                        const viewportHeight = window.innerHeight;
                        
                        // Check if tooltip goes off screen
                        let leftOffset = 0;
                        let topOffset = 0;
                        
                        // Adjust horizontal position if too far right
                        if (rect.left + tooltipRect.width / 2 > viewportWidth - 20) {
                            leftOffset = viewportWidth - rect.left - tooltipRect.width - 20;
                        }
                        // Adjust horizontal position if too far left
                        else if (rect.left - tooltipRect.width / 2 < 20) {
                            leftOffset = 20 - rect.left + tooltipRect.width / 2;
                        }
                        
                        // Adjust vertical position if too high
                        if (rect.top - tooltipRect.height < 20) {
                            topOffset = tooltipRect.height + 20;
                            tooltip.style.bottom = 'auto';
                            tooltip.style.top = '100%';
                            tooltip.style.transform = 'translateX(-50%) translateY(5px)';
                            // Update arrow position
                            tooltip.querySelector('::after')?.remove();
                            const arrow = document.createElement('div');
                            arrow.style.cssText = `
                                position: absolute;
                                bottom: 100%;
                                left: 50%;
                                transform: translateX(-50%);
                                border: 6px solid transparent;
                                border-bottom-color: rgba(10, 14, 39, 0.95);
                            `;
                        }
                        
                        if (leftOffset !== 0) {
                            tooltip.style.left = leftOffset + 'px';
                            tooltip.style.transform = 'translateX(0) translateY(-5px)';
                        }
                    }
                });
            });
        });
    </script>

    <!-- Background Music Player -->
    <div class="music-player" id="musicPlayer">
        <button class="music-toggle" id="musicToggle" aria-label="Toggle music">
            <span class="music-icon">ðŸŽµ</span>
        </button>
        <audio id="backgroundMusic" loop>
            <source src="{% static 'entries/audio/define-myself.mp3' %}" type="audio/mpeg">
        </audio>
        <div class="music-info">
            <div class="music-credits">
                <p class="music-title">"Define Myself"</p>
                <p class="music-artist">by <strong>Marcus Maison</strong> & <strong>Mandi Fisher</strong></p>
                <a href="https://music.apple.com/mx/album/define-myself/1854798584?i=1854798585" target="_blank" class="music-link">
                    ðŸŽµ Download on Apple Music â†’
                </a>
            </div>
        </div>
    </div>

    <script>
        const musicToggle = document.getElementById('musicToggle');
        const backgroundMusic = document.getElementById('backgroundMusic');
        let musicPlaying = false;

        // Check if user previously enabled music
        const musicEnabled = localStorage.getItem('musicEnabled') === 'true';
        
        musicToggle.addEventListener('click', function() {
            if (musicPlaying) {
                backgroundMusic.pause();
                musicToggle.classList.remove('playing');
                musicPlaying = false;
                localStorage.setItem('musicEnabled', 'false');
            } else {
                // Try to play - will only work if audio source is set
                backgroundMusic.play().then(() => {
                    musicToggle.classList.add('playing');
                    musicPlaying = true;
                    localStorage.setItem('musicEnabled', 'true');
                }).catch(() => {
                    // Audio source not set or autoplay blocked
                    console.log('Music file not available or autoplay blocked');
                });
            }
        });

        // Restore music state if previously enabled
        if (musicEnabled && backgroundMusic.src) {
            backgroundMusic.play().then(() => {
                musicToggle.classList.add('playing');
                musicPlaying = true;
            }).catch(() => {});
        }
    </script>
</body>
</html>

